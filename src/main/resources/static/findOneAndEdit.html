<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>

<div>
    <input id="person-id" placeholder="Add id for person to find">
    <button id="btn-find">Find Person</button>
</div>
<p id="error1" style="color: red;"></p>
<form>
    <p>ID: <span id="id-for-person"></span> </p>
    <div><input id="f-name" placeholder="firstName" /></div>
    <br />
    <div><input id="l-name" placeholder="lastName"></div>
    <br/>
    <button id="btn-save">Save Changes</button>
</form>
<p id="status"></p>
<p><a href="/">Back</a></p>

<script>

    function handleHttpErrors(res) {
        if (!res.ok) {
            return res.json()
                .then(body => {
                    const error = new Error(body.message)
                    error.apiError = body
                    throw error
                })
        }
        return res.json()
    }


    const SERVER_URL = sessionStorage.getItem("SERVER_URL")

    document.getElementById("btn-find").onclick = ()=>{

            fetch(SERVER_URL+"/"+document.getElementById("person-id").value)
                .then(handleHttpErrors)
                .then(d=> {
                    document.getElementById("id-for-person").textContent = d.id
                    document.getElementById("f-name").value=d.firstName
                    document.getElementById("l-name").value=d.lastName
                })
                .catch(err => {
                    console.log(err.message);
                    if (err.apiError) { //Check if this was an API-error
                        document.getElementById("error1").innerText= err.message
                    }
                })




    }

    document.getElementById("btn-save").onclick = (evt)=>{
        evt.preventDefault()
        const newPerson = {}
        newPerson.firstName = document.getElementById("f-name").value
        newPerson.lastName = document.getElementById("l-name").value
        const options = {
            method: "PUT",
            headers : {
                'Content-Type' : 'application/json'
            },
            body: JSON.stringify(newPerson)
        }
        fetch(SERVER_URL+"/"+document.getElementById("person-id").value,options)
            .then(res=>res.json())
            .then(p=> document.getElementById("status").innerText = JSON.stringify(p))
    }


</script>
</body>
</html>